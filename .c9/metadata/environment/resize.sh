{"filter":false,"title":"resize.sh","tooltip":"/resize.sh","undoManager":{"mark":3,"position":3,"stack":[[{"start":{"row":0,"column":0},"end":{"row":62,"column":0},"action":"insert","lines":["","#!/bin/bash","","# Specify the desired volume size in GiB as a command line argument. If not specified, default to 20 GiB.","SIZE=${1:-20}","","# Get the ID of the environment host Amazon EC2 instance.","TOKEN=$(curl -s -X PUT \"http://169.254.169.254/latest/api/token\" -H \"X-aws-ec2-metadata-token-ttl-seconds: 60\")","INSTANCEID=$(curl -s -H \"X-aws-ec2-metadata-token: $TOKEN\" -v http://169.254.169.254/latest/meta-data/instance-id 2> /dev/null)","REGION=$(curl -s -H \"X-aws-ec2-metadata-token: $TOKEN\" -v http://169.254.169.254/latest/meta-data/placement/region 2> /dev/null)","","# Get the ID of the Amazon EBS volume associated with the instance.","VOLUMEID=$(aws ec2 describe-instances \\","  --instance-id $INSTANCEID \\","  --query \"Reservations[0].Instances[0].BlockDeviceMappings[0].Ebs.VolumeId\" \\","  --output text \\","  --region $REGION)","","# Resize the EBS volume.","aws ec2 modify-volume --volume-id $VOLUMEID --size $SIZE","","# Wait for the resize to finish.","while [ \\","  \"$(aws ec2 describe-volumes-modifications \\","    --volume-id $VOLUMEID \\","    --filters Name=modification-state,Values=\"optimizing\",\"completed\" \\","    --query \"length(VolumesModifications)\"\\","    --output text)\" != \"1\" ]; do","sleep 1","done","","# Check if we're on an NVMe filesystem","if [[ -e \"/dev/xvda\" && $(readlink -f /dev/xvda) = \"/dev/xvda\" ]]","then","# Rewrite the partition table so that the partition takes up all the space that it can.","  sudo growpart /dev/xvda 1","# Expand the size of the file system.","# Check if we're on AL2","  STR=$(cat /etc/os-release)","  SUB=\"VERSION_ID=\\\"2\\\"\"","  if [[ \"$STR\" == *\"$SUB\"* ]]","  then","    sudo xfs_growfs -d /","  else","    sudo resize2fs /dev/xvda1","  fi","","else","# Rewrite the partition table so that the partition takes up all the space that it can.","  sudo growpart /dev/nvme0n1 1","","# Expand the size of the file system.","# Check if we're on AL2","  STR=$(cat /etc/os-release)","  SUB=\"VERSION_ID=\\\"2\\\"\"","  if [[ \"$STR\" == *\"$SUB\"* ]]","  then","    sudo xfs_growfs -d /","  else","    sudo resize2fs /dev/nvme0n1p1","  fi","fi",""],"id":1}],[{"start":{"row":7,"column":31},"end":{"row":7,"column":46},"action":"remove","lines":["169.254.169.254"],"id":4},{"start":{"row":7,"column":31},"end":{"row":7,"column":42},"action":"insert","lines":["34.230.0.90"]}],[{"start":{"row":8,"column":69},"end":{"row":8,"column":84},"action":"remove","lines":["169.254.169.254"],"id":5},{"start":{"row":8,"column":69},"end":{"row":8,"column":80},"action":"insert","lines":["34.230.0.90"]}],[{"start":{"row":9,"column":65},"end":{"row":9,"column":80},"action":"remove","lines":["169.254.169.254"],"id":6},{"start":{"row":9,"column":65},"end":{"row":9,"column":76},"action":"insert","lines":["34.230.0.90"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":23,"column":45},"end":{"row":23,"column":45},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1690991372217,"hash":"42060ee1451bd54459edf45e721ae3cb4016a6d9"}